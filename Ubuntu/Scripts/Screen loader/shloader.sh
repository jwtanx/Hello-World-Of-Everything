#!/bin/bash
set -Eeuo pipefail
trap end_shloader SIGINT SIGTERM ERR EXIT RETURN
tput civis


# Loaders
# EMOJIS
emoji_hour=( 0.08 'üïõ' 'üïê' 'üïë' 'üïí' 'üïì' 'üïî' 'üïï' 'üïñ' 'üïó' 'üïò' 'üïô' 'üïö')
emoji_face=( 0.08 'üòê' 'üòÄ' 'üòç' 'üôÑ' 'üòí' 'üò®' 'üò°')
emoji_earth=( 0.1 üåç üåé üåè )
emoji_moon=( 0.08 üåë üåí üåì üåî üåï üåñ üåó üåò )
emoji_orange_pulse=( 0.1 üî∏ üî∂ üü† üü† üî∂ )
emoji_blue_pulse=( 0.1 üîπ üî∑ üîµ üîµ üî∑ )
emoji_blink=( 0.06 üòê üòê üòê üòê üòê üòê üòê üòê üòê üòë )
emoji_camera=( 0.05 üì∑ üì∑ üì∑ üì∑ üì∑ üì∑ üì∑ üì∑ üì∑ üì∑ üì∑ üì∑ üì∑ üì∑ üì∑ üì∑ üì∑ üì∑ üì∑ üì∑ üì∏ üì∑ üì∏ )
emoji_sick=( 0.2 ü§¢ ü§¢ ü§Æ )
emoji_monkey=( 0.2 üôâ üôà üôä üôà )
emoji_bomb=( 0.2 'üí£   ' ' üí£  ' '  üí£ ' '   üí£' '   üí£' '   üí£' '   üí£' '   üí£' '   üí•' '    ' '    ' )
# ASCII
ball=( 0.2 '(‚óè)' '(‚ö¨)')
arrow=( 0.06 '‚Üë' '‚Üó' '‚Üí' '‚Üò' '‚Üì' '‚Üô' '‚Üê' '‚Üñ')
cym=( 0.1 '‚äè' '‚äì' '‚äê' '‚äî')
x_plus=( 0.08 '√ó' '+')
line=( 0.08 '‚ò∞' '‚ò±' '‚ò≥' '‚ò∑' '‚ò∂' '‚ò¥')
loading=( 0.15 '>>>' '‚ñê' '‚ñê‚ñê‚ñê‚ñê' '‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê' '‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê' '‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê' '‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê‚ñê')
ball_wave=( 0.1 'ìÉâìÉâìÉâ' 'ìÉâìÉâ‚àò' 'ìÉâ‚àò¬∞' '‚àò¬∞‚àò' '¬∞‚àòìÉâ' '‚àòìÉâìÉâ')
old=( 0.07 '‚Äî' "\\" '|' '/' )
dots=( 0.04 '‚£æ' '‚£Ω' '‚£ª' '‚¢ø' '‚°ø' '‚£ü' '‚£Ø' '‚£∑' )
dots2=( 0.04 '‚†ã' '‚†ô' '‚†π' '‚†∏' '‚†º' '‚†¥' '‚†¶' '‚†ß' '‚†á' '‚†è' )
dots3=( 0.04 '‚†ã' '‚†ô' '‚†ö' '‚†û' '‚†ñ' '‚†¶' '‚†¥' '‚†≤' '‚†≥' '‚†ì' )
dots4=( 0.04 '‚†Ñ' '‚†Ü' '‚†á' '‚†ã' '‚†ô' '‚†∏' '‚†∞' '‚††' '‚†∞' '‚†∏' '‚†ô' '‚†ã' '‚†á' '‚†Ü' )
dots5=( 0.04 '‚†ã' '‚†ô' '‚†ö' '‚†í' '‚†Ç' '‚†Ç' '‚†í' '‚†≤' '‚†¥' '‚†¶' '‚†ñ' '‚†í' '‚†ê' '‚†ê' '‚†í' '‚†ì' '‚†ã' )
dots6=( 0.04 '‚†Å' '‚†â' '‚†ô' '‚†ö' '‚†í' '‚†Ç' '‚†Ç' '‚†í' '‚†≤' '‚†¥' '‚†§' '‚†Ñ' '‚†Ñ' '‚†§' '‚†¥' '‚†≤' '‚†í' '‚†Ç' '‚†Ç' '‚†í' '‚†ö' '‚†ô' '‚†â' '‚†Å' )
dots7=( 0.04 '‚†à' '‚†â' '‚†ã' '‚†ì' '‚†í' '‚†ê' '‚†ê' '‚†í' '‚†ñ' '‚†¶' '‚†§' '‚††' '‚††' '‚†§' '‚†¶' '‚†ñ' '‚†í' '‚†ê' '‚†ê' '‚†í' '‚†ì' '‚†ã' '‚†â' '‚†à' )
dots8=( 0.04 '‚†Å' '‚†Å' '‚†â' '‚†ô' '‚†ö' '‚†í' '‚†Ç' '‚†Ç' '‚†í' '‚†≤' '‚†¥' '‚†§' '‚†Ñ' '‚†Ñ' '‚†§' '‚††' '‚††' '‚†§' '‚†¶' '‚†ñ' '‚†í' '‚†ê' '‚†ê' '‚†í' '‚†ì' '‚†ã' '‚†â' '‚†à' '‚†à' )
dots9=( 0.04  '‚¢π' '‚¢∫' '‚¢º' '‚£∏' '‚£á' '‚°ß' '‚°ó' '‚°è' )
dots10=( 0.04  '‚¢Ñ' '‚¢Ç' '‚¢Å' '‚°Å' '‚°à' '‚°ê' '‚°†' )
dots11=( 0.04 '‚†Å' '‚†Ç' '‚†Ñ' '‚°Ä' '‚¢Ä' '‚††' '‚†ê' '‚†à' )


die() {
  local code=${2-1}
  exit "$code"
}


usage() {
  cat <<EOF

Available options:

-h, --help            <OPTIONAL>    Print this help and exit
-l, --loader          <OPTIONAL>   Chose loader to display
-m, --message         <OPTIONAL>    Text to display while loading
-e, --ending          <OPTIONAL>    Text to display when finishing

EOF
  exit 0
}


play_shloader() {
  while true ; do
    for frame in "${loader[@]}" ; do
      printf "\r%s" "${frame} ${message}"
      sleep "${speed}"
    done
  done
}


end_shloader() {
  kill "${shloader_pid}" &>/dev/null
  tput cnorm
  if [[ "${ending}" ]]; then
    printf "\r${ending}"; echo
  fi
}


shloader() {
  loader=''
  message=''
  ending=''

  while :; do
    case "${1-}" in
    -h | --help) usage;;
    -l | --loader)
      loader="${2-}"
      shift
      ;;
    -m | --message)
      message="${2-}"
      shift
      ;;
    -e | --ending)
      ending="${2-}"
      shift
      ;;
    -?*) die "Unknown option: $1" ;;
    *) break ;;
    esac
    shift
  done

  if [[ -z "${loader}" ]] ; then
    loader=dots[@]
  else
    loader=$loader[@]
  fi

  loader=( ${!loader} )
  speed="${loader[0]}"
  unset "loader[0]"

  tput civis
  play_shloader &
  shloader_pid="${!}"
}

shloader